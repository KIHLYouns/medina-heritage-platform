spring.application.name=user-auth-service

# --- DATABASE ---
server.port=${USER_AUTH_SERVICE_PORT}
spring.datasource.url=${USER_AUTH_DATABASE_URL}
spring.datasource.username=${USER_AUTH_DATABASE_USERNAME}
spring.datasource.password=${USER_AUTH_DATABASE_PASSWORD}
spring.jpa.hibernate.ddl-auto=${JPA_HIBERNATE_DDL_AUTO:update}
spring.sql.init.mode=${SPRING_SQL_INIT_MODE:always}

# --- CORS ---
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080}
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true
cors.max-age=3600

# --- LOGGING ---
logging.level.com.medina.heritage=DEBUG
logging.level.com.medina.heritage.userauth.controller=DEBUG
logging.level.com.medina.heritage.userauth.service=DEBUG
logging.level.org.springframework.cloud.stream=DEBUG
logging.level.org.springframework.cloud.stream.binder=DEBUG
logging.level.org.springframework.integration=DEBUG

# --- RABBITMQ CONNECTIVITY ---
spring.rabbitmq.host=${RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${RABBITMQ_PORT:5672}
spring.rabbitmq.username=${RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${RABBITMQ_PASSWORD:guest}

# ============================================================
# SPRING CLOUD STREAM CONFIGURATION
# ============================================================

spring.cloud.function.definition=userCreatedByClerkConsumer

# ------------------------------------------------------------
# PRODUCTEUR (OUTBOUND)
# ------------------------------------------------------------

# 1. Clerk Create
spring.cloud.stream.bindings.userCreatedByClerkSupplier-out-0.destination=heritage.users.topic
spring.cloud.stream.rabbit.bindings.userCreatedByClerkSupplier-out-0.producer.routing-key-expression='user.created.clerk'

# 2. Clerk Update
spring.cloud.stream.bindings.userUpdatedByClerkSupplier-out-0.destination=heritage.users.topic
spring.cloud.stream.rabbit.bindings.userUpdatedByClerkSupplier-out-0.producer.routing-key-expression='user.updated.clerk'

# 3. User Created (Interne)
spring.cloud.stream.bindings.userCreatedSupplier-out-0.destination=heritage.users.topic
spring.cloud.stream.rabbit.bindings.userCreatedSupplier-out-0.producer.routing-key-expression='user.created'

# 4. User Updated (Interne)
spring.cloud.stream.bindings.userUpdatedSupplier-out-0.destination=heritage.users.topic
spring.cloud.stream.rabbit.bindings.userUpdatedSupplier-out-0.producer.routing-key-expression='user.updated'

# 5. User Deleted (Interne)
spring.cloud.stream.bindings.userDeletedSupplier-out-0.destination=heritage.users.topic
spring.cloud.stream.rabbit.bindings.userDeletedSupplier-out-0.producer.routing-key-expression='user.deleted'

# ------------------------------------------------------------
# CONSOMMATEUR (INBOUND)
# ------------------------------------------------------------

# 1. CREATE via CLERK
spring.cloud.stream.bindings.userCreatedByClerkConsumer-in-0.destination=heritage.users.topic
spring.cloud.stream.bindings.userCreatedByClerkConsumer-in-0.group=user-auth-service
spring.cloud.stream.rabbit.bindings.userCreatedByClerkConsumer-in-0.consumer.binding-routing-key=user.created.clerk
spring.cloud.stream.bindings.userCreatedByClerkConsumer-in-0.consumer.max-attempts=3

# Clerk Webhook Configuration
clerk.webhook.secret=whsec_o74/ngXS3D6wgcgncUptWjhM4+6eyHyr

