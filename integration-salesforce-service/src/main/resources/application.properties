# ==========================================
# GENERAL
# ==========================================
spring.application.name=integration-salesforce-service

# ============ Server Configuration ============
server.port=${INTEGRATION_SALESFORCE_SERVICE_PORT:8086}

# ============ Database Configuration ============
spring.datasource.url=${INTEGRATION_SALESFORCE_DATABASE_URL:jdbc:postgresql://localhost:5432/heritage_db}
spring.datasource.username=${INTEGRATION_SALESFORCE_DATABASE_USERNAME:postgres}
spring.datasource.password=${INTEGRATION_SALESFORCE_DATABASE_PASSWORD:1234}
spring.jpa.hibernate.ddl-auto=${JPA_HIBERNATE_DDL_AUTO:update}
spring.sql.init.mode=${SPRING_SQL_INIT_MODE:always}

# ============ RabbitMQ Configuration ============
spring.rabbitmq.host=${RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${RABBITMQ_PORT:5672}
spring.rabbitmq.username=${RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${RABBITMQ_PASSWORD:guest}

# ============ Kafka Configuration ============
# Producer pour envoyer les status updates au système externe
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:54.226.8.25:9092}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3

# Topic Kafka pour les status updates
kafka.topics.claim-status-updates=claims.status-updates

# Topic Kafka pour les réponses de service
kafka.topics.claim-responses=claims.responses

# ============ Salesforce Configuration ============
salesforce.client-id=${SALESFORCE_CLIENT_ID}
salesforce.client-secret=${SALESFORCE_CLIENT_SECRET}
salesforce.username=${SALESFORCE_USERNAME}
salesforce.password=${SALESFORCE_PASSWORD}
salesforce.auth-url=${SALESFORCE_AUTH_URL}
salesforce.instance-url=${SALESFORCE_INSTANCE_URL}
salesforce.api-version=${SALESFORCE_API_VERSION:v65.0}
salesforce.default-account-id=${SALESFORCE_DEFAULT_ACCOUNT_ID}

# ============ Logging ============
logging.level.com.medina.heritage.integration=INFO


# ============ Spring Cloud Stream Bindings ============
# INPUT: Consommation des événements d'alerte citoyenne identifiée
spring.cloud.stream.bindings.citizenAlertIdentifiedConsumer-in-0.destination=building.citizen.alert.identified
spring.cloud.stream.bindings.citizenAlertIdentifiedConsumer-in-0.group=integration-salesforce-service



# ============================================================
# SPRING CLOUD STREAM CONFIGURATION
# ============================================================

# Function definitions
spring.cloud.function.definition=userCreatedConsumer;buildingCreatedConsumer;buildingUpdatedConsumer;citizenAlertIdentifiedConsumer;riskAlertConsumer

# CONSUMER 1: User Created Events
spring.cloud.stream.bindings.userCreatedConsumer-in-0.destination=heritage.users.topic
spring.cloud.stream.bindings.userCreatedConsumer-in-0.group=salesforce-integrator
spring.cloud.stream.rabbit.bindings.userCreatedConsumer-in-0.consumer.binding-routing-key=user.created

# CONSUMER 2: Building Created Events
spring.cloud.stream.bindings.buildingCreatedConsumer-in-0.destination=heritage.building.exchange
spring.cloud.stream.bindings.buildingCreatedConsumer-in-0.group=integration-group
spring.cloud.stream.rabbit.bindings.buildingCreatedConsumer-in-0.consumer.binding-routing-key=building.created

# CONSUMER 3: Building Updated Events
spring.cloud.stream.bindings.buildingUpdatedConsumer-in-0.destination=heritage.building.exchange
spring.cloud.stream.bindings.buildingUpdatedConsumer-in-0.group=integration-group
spring.cloud.stream.rabbit.bindings.buildingUpdatedConsumer-in-0.consumer.binding-routing-key=building.updated

# PRODUCER: Case Status Update Events (published via StreamBridge)
spring.cloud.stream.bindings.caseStatusUpdate-out-0.destination=heritage.salesforce.exchange
spring.cloud.stream.rabbit.bindings.caseStatusUpdate-out-0.producer.routing-key-expression=headers['routing-key']
# ==========================================
# CONSUMER 3 : IoT Risk Alert
# ==========================================
spring.cloud.stream.bindings.riskAlertConsumer-in-0.destination=iot.risk.alert
spring.cloud.stream.bindings.riskAlertConsumer-in-0.group=integration-salesforce-service

